!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function o(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,r){return(e=c(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var l=function(t){return void 0!==t&&!function(t){return null===t}(t)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function f(t,e){return Array.from(e).map((function(e,r){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,r))})).join("")}var v=function(t,e){return f(t,e=function(t){var e,r,n,i,o,a,s=0,u=[];if(!t)return t;t+="";do{e=(a=h.indexOf(t.charAt(s++))<<18|h.indexOf(t.charAt(s++))<<12|(i=h.indexOf(t.charAt(s++)))<<6|(o=h.indexOf(t.charAt(s++))))>>16&255,r=a>>8&255,n=255&a,u.push(e),64!==i&&(u.push(r),64!==o&&u.push(n))}while(s<t.length);return u}(e))},g=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},p=function(t){return t.toUpperCase()},d=function(t,e,r){switch(r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return y(e).test(t);default:return!1}},y=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var r=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(r,e)},S=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},m=window.ApxorLogger,_=o((function e(){var i=this;n(this,e),a(this,"nDsX","ALL"),a(this,"mWCc",[]),a(this,"yocd",[]),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(i.nDsX=t.audience.audience_type,i.mWCc=t.audience.attributes.user,i.yocd=t.audience.attributes.session,!Array.isArray(i.mWCc)||!Array.isArray(i.yocd))return m.error("No attributes"),!1}catch(t){return m.error(t),!1}return!0})),a(this,"validate",(function(e,r){var n=!0;return"FTU"===i.nDsX&&(n=t.getController().getSessionInfo().is_first_session),n&&i.HRgx(e,i.mWCc)&&i.HRgx(r,i.yocd)})),a(this,"HRgx",(function(t,e){var n=e.length,i=!0;try{for(var o=function(){var r=e[a];if(!t.hasOwnProperty(r.name)||!1===i)return{v:!1};var n=r.operator,o=r.type,s=r.value.map((function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return d(t,e,n)}))}));i=i&&u},a=0;a<n;a++){var s=o();if("object"===r(s))return s.v}}catch(t){m.error(t),i=!1}return i}))})),w=window.ApxorLogger,A=o((function e(){var r=this;n(this,e),a(this,"cvdK",0),a(this,"bQND",0),a(this,"vWZG","SESSION"),a(this,"FJFX",0),a(this,"SdAe",0),a(this,"vhvo",0),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.cvdK=e.frequency.count,r.vhvo=r.cvdK,r.bQND=e.frequency.time_interval,r.vWZG=e.frequency.validity,r.SdAe=e.frequency.ses_lmt,r._dayCount=e.frequency.day_lmt;var n=t.getController().getFromStorage("qe_state"),i=JSON.parse(v(t.getSiteId(),n));if(!l(i)||!l(i[e._id]))return!0;if("SESSION"===r.vWZG){if(r.cvdK=parseInt(r.cvdK)-parseInt(i[e._id].SESSION),r.cvdK<=0)return console.warn("Max count limit reached for session:"+e._id),!1}else{if("OVERALL"!==r.vWZG)return w.info("Invalid config."),!1;if(r.cvdK=parseInt(r.cvdK)-parseInt(i[e._id].OVERALL),r.cvdK<=0)return console.warn("Max count limit reached for overall:"+e._id),!1}}catch(t){return w.error(t),!1}return!0})),a(this,"Wgmq",(function(){r.cvdK=r.cvdK-1})),a(this,"getFrequencyCount",(function(){return r.cvdK})),a(this,"JTtF",(function(){"SESSION"===r.vWZG&&(r.cvdK=r.vhvo,w.info("Campaign Limit reset"))})),a(this,"kUki",(function(e){try{if(r.cvdK<=0)return!1;var n=t.getController().getFromStorage("qe_state"),i=JSON.parse(v(t.getSiteId(),n));if(!l(i)||!l(i[e]))return!0;if(0!==r.SdAe)if(parseInt(r.SdAe)-parseInt(i[e].SESSION)<=0)return!1;if(0!==r._dayCount){x.getInstance();var o=S();if(parseInt(r._dayCount)-parseInt(i[e].DATES[o]||0)<=0)return!1}}catch(t){w.error("Error validating the frequency:"+t)}return!0}))})),b=o((function t(){var e=this;n(this,t),a(this,"upUv",""),a(this,"nDsX",""),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r;e.upUv=t.meta.name,e.nDsX=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(r=t.meta)||void 0===r?void 0:r.attr)||{}}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),G=window.ApxorLogger,E=o((function t(){var e=this;n(this,t),a(this,"WICb",-1),a(this,"KeNN",-1),a(this,"NPwg",-1),a(this,"rCwH",-1),a(this,"qVXh",!1),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return G.error("Not valid dates"),!1;if(e.WICb=Date.parse(t.validity.start_date),e.KeNN=Date.parse(t.validity.end_date),l(t.time_limits_in_day)&&(e.qVXh=t.time_limits_in_day,e.qVXh&&l(t.time_limits))){var r=(new Date).toISOString().split("T")[0];if(e.NPwg=Date.parse(r+"T"+t.time_limits.start_time+".000Z"),e.rCwH=Date.parse(r+"T"+t.time_limits.end_time+".000Z"),isNaN(e.NPwg)||isNaN(e.rCwH))return G.error("Not valid times"),!1}}catch(t){return G.error(t),!1}return!0})),a(this,"validate",(function(){var t=Date.now();return t>e.WICb&&t<e.KeNN&&(!e.qVXh||t>=e.NPwg&&t<=e.rCwH)}))})),q=o((function t(){var e=this;n(this,t),a(this,"upUv",""),a(this,"XTtp",{}),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.upUv=t.name,e.XTtp=t.additional_info}catch(t){return!1}return!0}))})),N=o((function t(){var e=this;n(this,t),a(this,"KuAM",0),a(this,"AuFW",0),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.KuAM=Number(t.lower),e.AuFW=Number(t.upper),isNaN(e.KuAM)||isNaN(e.AuFW))return!1}catch(t){return!1}return!0}))})),O=o((function t(){var e=this;n(this,t),a(this,"lDWI",0),a(this,"SJZh",""),a(this,"lSbq",""),a(this,"GXgS",new q),a(this,"Ocnk",new N),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.SJZh=t.event_type,e.lSbq=t.activity,e.GXgS.parse(t.details)&&e.Ocnk.parse(t.time_bounds)}catch(t){return!1}}))})),C=o((function t(){var e=this;n(this,t),a(this,"lDWI",0),a(this,"KaVg",-1),a(this,"cvdK",0),a(this,"VKui",""),a(this,"lSbq",""),a(this,"SJZh",""),a(this,"Ocnk",new N),a(this,"GXgS",new q),a(this,"sNRF",new O),a(this,"XtWL","AND"),a(this,"VdeG",!1),a(this,"nDsX",void 0),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.KaVg=t.sequence,e.cvdK=t.count_config.count,e.VKui=t.count_config.operator,e.lSbq=t.activity,e.SJZh=t.event_type,e.XtWL=t.combine_operator,e.nDsX=t.type,e.GXgS.parse(t.details)&&e.sNRF.parse(t.trigger)&&e.Ocnk.parse(t.time_bounds)}catch(t){return Logger.error(t),!1}}))})),X=window.ApxorLogger,D=function(){function e(){var i=this;n(this,e),a(this,"eMqC",0),a(this,"pqAw",""),a(this,"phZg",new C),a(this,"oqGH",!1),a(this,"AlGy",!1),a(this,"hqSn",0),a(this,"XtWL","AND"),a(this,"hwNV",-1),a(this,"VjEv",[]),a(this,"ubta",{}),a(this,"zgvN",!1),a(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];i.pqAw=r,i.hqSn=n,i.VjEv=a;var s=i.phZg.parse(e);if(s){if(i.XtWL=i.phZg.XtWL,i.phZg.VdeG){var u=i.phZg.GXgS.upUv;"APX_PAGE_OPENED"===u&&(u=i.phZg.GXgS.XTtp.navigation_id,u=isDefined(u)?u:i.phZg.GXgS.upUv),i.hwNV=t.getController().getEventCount(u);var c=i.phZg.cvdK,l=i.phZg.VKui;if(i.AlGy=i.BKPs(i.hwNV-1,c,l,!1),i.oqGH=i.AlGy,i.AlGy&&"APX_PAGE_OPENED"===i.phZg.GXgS.upUv)return!0}return o&&0!==n||i.NWPP(),!0}return!1})),a(this,"NWPP",(function(){var t=i.phZg,e=t.sNRF,r=x.getInstance();"app_start"===e.SJZh?(i.oqGH=!0,r.registerForEvent(g(t.SJZh)+"___"+t.GXgS.upUv,i.njXs)):r.registerForEvent(g(t.SJZh)+"___"+e.GXgS.upUv,i.njXs)})),a(this,"qhke",(function(t,e,r,n){var o,a,s,u=(Date.now()-i.ubta[e])/1e3;(null===(o=i.phZg)||void 0===o||null===(a=o.GXgS)||void 0===a||null===(s=a.XTtp)||void 0===s?void 0:s.time)/1e3>u&&i._displayCampaign()})),a(this,"zFjE",(function(t,e,r,n){var o,a,s,u,c;i.zgvN=!0;var l=Date.now(),h=null===(o=i.phZg)||void 0===o||null===(a=o.sNRF)||void 0===a?void 0:a.GXgS.upUv,f=(l-i.ubta[h])/1e3,v=null===(s=i.phZg)||void 0===s||null===(u=s.GXgS)||void 0===u||null===(c=u.XTtp)||void 0===c?void 0:c.time;(v/=1e3)>f&&i._displayCampaign()})),a(this,"njXs",(function(t,e,r,n){var o=x.getInstance();if(i.oqGH)g(i.phZg.SJZh)===t&&i.toTh(r-i.phZg.sNRF.lDWI,i.phZg.Ocnk)&&i.phZg.GXgS.upUv===e&&i.UkWj(i.phZg.GXgS.XTtp,n)&&(i.eMqC+=1,i.AlGy=i.BKPs(i.eMqC,i.phZg.cvdK,i.phZg.VKui),i.AlGy&&(i.phZg.lDWI=r,o.validate(i.pqAw,i.hqSn)));else if(i.oqGH=i.OPTJ(t,e,r,n),i.oqGH){var a=i.phZg,s=a.sNRF;if(s.lDWI=r,"activity_time"===(null==a?void 0:a.SJZh)){var u,c,l,h,f,v,d=null==a||null===(u=a.GXgS)||void 0===u||null===(c=u.XTtp)||void 0===c?void 0:c.time;(null==a||null===(l=a.GXgS)||void 0===l||null===(h=l.XTtp)||void 0===h?void 0:h.nkpi.length)>0&&(setTimeout((function(){i.zgvN||(i.AlGy=!0,i.AlGy&&(i.eMqC+=1,i.AlGy=i.BKPs(i.eMqC,i.phZg.cvdK,i.phZg.VKui),i.AlGy&&(i.phZg.lDWI=r,o.validate(i.pqAw,i.hqSn)))),a.GXgS.XTtp.nkpi.map((function(t){o.unregisterFromEvent(p(a.GXgS.XTtp.et)+"___"+t,i)}))}),d),a.GXgS.XTtp.nkpi.map((function(t){o.registerForEvent(p(a.GXgS.XTtp.et)+"___"+t,i.zFjE)}))),(null==a||null===(f=a.GXgS)||void 0===f||null===(v=f.XTtp)||void 0===v?void 0:v.kpi.length)>0&&(setTimeout((function(){a.GXgS.XTtp.kpi.map((function(t){o.unregisterFromEvent(p(a.GXgS.XTtp.et)+"___"+t,i)}))}),d),a.GXgS.XTtp.kpi.map((function(t){t===a.sNRF.GXgS.upUv?(o.unregisterFromEvent(g(s.SJZh)+"___"+s.GXgS.upUv,i),o.registerForEvent(p(a.GXgS.XTtp.et)+"___"+t,i.qhke)):o.registerForEvent(p(a.GXgS.XTtp.et)+"___"+t,i.zFjE)})))}else o.unregisterFromEvent(g(s.SJZh)+"___"+s.GXgS.upUv,i),o.registerForEvent(g(a.SJZh)+"___"+a.GXgS.upUv,i);i.ubta[e]=Date.now()}})),a(this,"OPTJ",(function(t,e,r,n){var o=i.phZg.sNRF;return g(o.SJZh)===t&&o.GXgS.upUv===e&&i.toTh(r,o.Ocnk)&&i.UkWj(o.GXgS.XTtp,n)})),a(this,"toTh",(function(t,e){var r=Math.round(t);return r>e.KuAM&&r<e.AuFW})),a(this,"BKPs",(function(t,e,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(n&&i.phZg.VdeG&&(t+=i.hwNV),r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),a(this,"UkWj",(function(t,e){var n=!0;try{var i=function(){if(!e.hasOwnProperty(o)||!1===n)return{v:!1};if("object"===r(t[o])){var i,a=t[o].op,s=t[o].t;"s"===s?i=t[o].val:"l"!==s&&"f"!==s||(i=parseFloat(t[o].val));var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return d(t,i,a)}));n=n&&u}else n=n&&d(e[o],t[o],"EQ")};for(var o in t){var a=i();if("object"===r(a))return a.v}}catch(t){X.error(t),n=!1}return n}))}return o(e,[{key:"_displayCampaign",value:function(){var t=x.getInstance();this.AlGy=!0,this.AlGy&&(this.eMqC+=1,this.AlGy=this.BKPs(this.eMqC,this.phZg.cvdK,this.phZg.VKui),this.AlGy&&(this.phZg.lDWI=time,t.validate(this.pqAw,this.hqSn)))}}]),e}(),T=o((function e(){var r=this;n(this,e),a(this,"tnBz",[]),a(this,"_ret_day",{}),a(this,"ryxC",{}),a(this,"xgGh",!1),a(this,"VNpe",!1),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.tnBz=t.overall_cfg.events,r._ret_day=t.overall_cfg.ret_day,r.ryxC=t.overall_cfg.session,r.xgGh=t.overall_cfg.toggleRetDay,r.tnBz=t.overall_cfg.events,r.VNpe=t.overall_cfg.toggleSession}catch(t){return Logger.error(error),!1}return!0})),a(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),n=parseInt(t.getController().getFromStorage("apx_retained_session"));if(r.xgGh&&!isNaN(e)&&!(e>=r._ret_day.from&&e<=r._ret_day.to))return!1;if(r.VNpe&&!isNaN(n)&&!(n>=r.ryxC.from&&n<=r.ryxC.to))return!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),o=t.getSiteId(),a=JSON.parse(v(o,i)),s=0;s<r.tnBz.length;s++){var u=r.tnBz[s].name.replace("'","").replace("â€™","");if(a.hasOwnProperty(u))return!1}}catch(t){Logger.error("Failed to validate the lt count:"+t)}return!0}))})),F=window.ApxorLogger,P=o((function r(){var i=this;n(this,r),a(this,"zllf",[]),a(this,"pqAw",""),a(this,"zaVw",new b),a(this,"YEPg",new _),a(this,"vWZG",new E),a(this,"qwAQ",new A),a(this,"RQvM",new T),a(this,"QsRD",!1),a(this,"QHnk",[]),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!l(t._id))return F.error("No Id"),!1;if(!l(t.enabled)||!t.enabled)return F.error("Not enabled"),!1;if(!(i.zaVw.parse(t)&&i.vWZG.parse(t)&&i.qwAQ.parse(t)&&i.YEPg.parse(t)&&i.RQvM.parse(t)))return!1;if(!l(t.conditions)||!Array.isArray(t.conditions))return F.error("No valid conditions",t.conditions),!1;i.pqAw=t._id,i.QsRD=!!l(t.sequence_enabled)&&t.sequence_enabled,i.QsRD&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var e=t.conditions,r=e.length,n=0;n<r;n++){i.QHnk=[];var o=e[n];if("didn't"===o.type){var a,u,c={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(a=o.details)||void 0===a||null===(u=a.additional_info)||void 0===u?void 0:u.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};i.QHnk=[].concat(s(i.QHnk),[c])}var h=new D;h.initialize(o,i.pqAw,n,i.QsRD,i.QHnk)&&i.zllf.push(h)}return i.zllf.length>0}catch(t){return F.error(t),!1}})),a(this,"OCRT",(function(t){if(!(t<0))if(i.QsRD){var e=i.zllf[t];if(l(e)&&e.AlGy){var r=i.zllf[t-1];if(l(r)&&!r.AlGy)return;var n=i.zllf[t+1];l(n)?n.NWPP():i.AgfL()}}else i.AgfL()})),a(this,"AgfL",(function(){var r=t.getController().getUserAttributes(),n=t.getController().getSessionAttributes();if(i.vWZG.validate()&&i.YEPg.validate(r,n)&&i.RQvM.validate()){for(var o=i.zllf.length,s=o<1,u="",c=0;c<o;c++){var l=i.zllf[c],h=l.AlGy;if(""===u.trim())s=h;else switch(u){case"AND":s=s&&h;break;case"OR":s=s||h}u=l.XtWL}if(s){if(console.debug("onCondition satisfied"),!i.qwAQ.kUki(i.pqAw))return void console.warn("Maximum limit reached",i.pqAw);console.log("Dispatching event",i.zaVw.nDsX),!0===i.zaVw._only_context&&t.logEvent("apx_context_evaluated",function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},i.zaVw._attr)),t.getController().dispatchEvent(i.zaVw.nDsX,{name:i.zaVw.nDsX,additional_info:{uuid:i.pqAw,name:i.zaVw.upUv}})}}})),a(this,"Wgmq",(function(){i.qwAQ.Wgmq()})),a(this,"getFrequencyCount",(function(){return i.qwAQ.getFrequencyCount()})),a(this,"rmww",(function(){return i.qwAQ.JTtF()}))})),W=o((function t(){var e=this;n(this,t),a(this,"yEdD",{}),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(l(t)&&l(t.configs)){var r=t.configs;if(!Array.isArray(r))return;r.sort((function(t,e){var r,n;return(null!==(r=t.prio)&&void 0!==r?r:-1)-(null!==(n=e.prio)&&void 0!==n?n:-1)}));for(var n=0;n<r.length;n++){var i=r[n],o=i._id,a=new P;a.parse(i)?e.yEdD[o]=a:console.warn("Failed to parse cfg",o)}}})),a(this,"validate",(function(t,r){e.yEdD.hasOwnProperty(t)&&e.yEdD[t].OCRT(r)})),a(this,"Wgmq",(function(t){e.yEdD[t].Wgmq()})),a(this,"getFrequencyCount",(function(t){return e.yEdD[t].getFrequencyCount()})),a(this,"resetFrequencyCounts",(function(){var t=e.yEdD;for(var r in t)t[r].rmww()})),a(this,"WpUM",(function(t){if(Array.isArray(e.yEdD)){var r=e.yEdD[t];if(r)return r.zaVw}return{}}))})),Z=window.ApxorLogger,I=o((function e(){var r=this;n(this,e),a(this,"GlPW",{}),a(this,"rGQi",[]),a(this,"BCRL",!1),a(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return r.Xgfk(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return r.Xgfk(t,"CE")}))})),a(this,"IdaK",(function(){for(var t in r.rGQi)r.IQbR(t.event,t.key,t.type);r.BCRL=!0})),a(this,"ftQS",(function(t,e){var n;"function"==typeof e&&((n=r.GlPW[t]?r.GlPW[t]:[]).push(e),r.GlPW[t]=n,Z.debug("Listeners list: ",r.GlPW))})),a(this,"unregisterFromEvent",(function(t,e){if(r.GlPW[t]){for(var n=r.GlPW[t],i=[],o=0;o<n.length;o++){var a=n[o];a!==e&&i.push(a)}r.GlPW[t]=i}})),a(this,"Xgfk",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",n=e+"___"+t.name;r.IQbR(t,n,e)})),a(this,"IQbR",(function(e,n,i){if(r.BCRL){if(Z.debug("Notifying listeners for event: "+e+", "+n,r.GlPW),r.GlPW[n])for(var o=r.GlPW[n],a=t.getController().getTime(),s=0;s<o.length;s++){(0,o[s])(i,e.name,a,e.additional_info)}}else r.rGQi.push({event:e,key:n,type:i})}))})),K=window.ApxorLogger,x=function(){function e(){var r=this;return n(this,e),a(this,"guzf",!1),a(this,"YOUO",null),a(this,"KbHp",S()),a(this,"acTf",new I),a(this,"bQGV",t.getSiteId()),a(this,"eSdf",{}),a(this,"initialize",(function(){if(!r.guzf){r.guzf=!0,r.YOUO=new W,r.acTf.initialize();var e=t.getController().getFromStorage("qe_state");e?r.eSdf=JSON.parse(v(r.bQGV,e)):t.getController().persistToStorage("qe_state",r.eSdf,!0),K.info("QE Initialized..")}})),a(this,"parse",(function(t){r.rcSN()?(r.YOUO.parse(t),r.acTf.IdaK()):K.warn("Must call init first. Unable to proceed")})),a(this,"validate",(function(t,e){r.rcSN()&&r.YOUO.validate(t,e)})),a(this,"updateCount",(function(e){try{l(r.eSdf[e])||r.createObjConfig(e),r.incrementFrequencies(e),t.getController().persistToStorage("qe_state",r.eSdf,!0),r.YOUO.Wgmq(e)}catch(t){console.log("Could not update the count config:".concat(t))}})),a(this,"resetFrequencyCounts",(function(){r.YOUO.resetFrequencyCounts()})),a(this,"getFrequencyCount",(function(t){return r.YOUO.getFrequencyCount(t)})),a(this,"registerForEvent",(function(t,e){r.acTf.ftQS(t,e)})),a(this,"unregisterFromEvent",(function(t,e){r.acTf.unregisterFromEvent(t,e)})),a(this,"fetch",(function(e,r,n,i){t.getController().fetchConfiguration(e,r,n,i)})),a(this,"rcSN",(function(){return r.guzf})),a(this,"getCampaignMetaFromQueryEngine",(function(t){return r.YOUO.WpUM(t)})),a(this,"oDeO",(function(){return r.KbHp})),e.instance||(e.instance=this),e.instance}return o(e,[{key:"createObjConfig",value:function(e){try{var r=t.getController().getFromStorage("qe_state");this.eSdf=JSON.parse(v(this.bQGV,r)),l(this.eSdf[e])||(this.eSdf[e]={SESSION:0,OVERALL:0,DATES:{}},this.KbHp&&(this.eSdf[e].DATES[this.KbHp]=0),t.getController().persistToStorage("qe_state",this.eSdf,!0))}catch(t){K.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(e){var r=t.getController().getFromStorage("qe_state");this.eSdf=JSON.parse(v(this.bQGV,r));var n=this.eSdf[e];n.SESSION=n.SESSION+1,n.OVERALL=n.OVERALL+1;var i=S();i!==this.KbHp&&(this.KbHp=i,n.DATES={},n.DATES[this.KbHp]=0),n.DATES[this.KbHp]=n.DATES[this.KbHp]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();a(x,"instance",void 0),window.ceVersion=115;try{void 0===exports&&null===exports||(exports.default=x,module.exports=exports.default)}catch(t){}return x}));
